 Resumen TÃ©cnico Completo â€“ Proyecto: MicroTwitter con DevOps CI/CD + GitOps
ğŸ¯ Objetivo General
Desarrollar y desplegar una aplicaciÃ³n tipo MicroTwitter (foro de publicaciones tipo tweet) como un laboratorio DevOps completo que demuestre:

Microservicios en Kubernetes (FastAPI + Vue.js)

GitOps con ArgoCD

CI/CD automatizado con Jenkins

Observabilidad con Grafana, Loki, cAdvisor y Alloy

Almacenamiento persistente con PVC sobre NFS

ComunicaciÃ³n entre microservicios

Arquitectura realista y escalable para producciÃ³n

ğŸ§± Arquitectura General
plaintext
Copiar
Editar
                         +------------------+
                         |    Developer     |
                         +--------+---------+
                                  |
                             (1) Git Push
                                  |
                      +-----------v----------+
                      |      Jenkins         |
                      +-----------+----------+
                                  |
        +-------------------------+--------------------------+
        |                       CI/CD                        |
        |  - build Docker images                              |
        |  - push a Docker Hub                                |
        |  - update GitOps repo (deployment.yaml)             |
        +-------------------------+--------------------------+
                                  |
                           +------v-------+
                           |   ArgoCD     |  <â”€â”€â”€ Auto-sync GitOps repo
                           +------+-------+
                                  |
                             Apply YAMLs
                                  |
     +----------------------------v---------------------------+
     |                      Kubernetes K3s                    |
     |  +------------------+ +----------------+ +------------+|
     |  | users-service    | | posts-service  | | frontend   ||
     |  +--------+---------+ +--------+-------+ +------------+|
     |           |                    |                        |
     |           +----- Internal HTTP/REST via svc ---------->|
     +--------------------------------------------------------+
                                  |
                             Ingress (Traefik)
                                  |
                      Public domain (frontend.socialdevs.site)

ğŸ“¦ Microservicios
Servicio	DescripciÃ³n	TecnologÃ­a
frontend	Interfaz web tipo Twitter (SPA)	Vue.js + Nginx
users-service	API para usuarios (crear, listar)	FastAPI
posts-service	API para publicaciones (crear, listar)	FastAPI
postgresql	Base de datos persistente	PostgreSQL

ğŸ“ Estructura de Repositorios
1. socialdevs-public-frontend/ (cÃ³digo fuente)
plaintext
Copiar
Editar

socialdevs-public-frontend/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Jenkinsfile
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html
â””â”€â”€ src/
    â”œâ”€â”€ main.js
    â”œâ”€â”€ App.vue
    â”œâ”€â”€ router/
    â”‚   â””â”€â”€ index.js
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ Header.vue
    â”‚   â””â”€â”€ TweetCard.vue
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ Home.vue
    â”‚   â”œâ”€â”€ Login.vue
    â”‚   â””â”€â”€ Register.vue
    â””â”€â”€ utils/
        â””â”€â”€ api.js




Incluye Vue.js SPA, empaquetado por Vite, desplegado por Nginx en contenedor.

1. socialdevs-gitops/ (manifiestos GitOps)
plaintext
Copiar
Editar
socialdevs-gitops/
â””â”€â”€ apps/
    â””â”€â”€ socialdevs-frontend/
        â”œâ”€â”€ base/
        â”‚   â”œâ”€â”€ deployment.yaml
        â”‚   â”œâ”€â”€ service.yaml
        â”‚   â”œâ”€â”€ ingress.yaml
        â”‚   â””â”€â”€ kustomization.yaml
        â””â”€â”€ overlays/
            â”œâ”€â”€ dev/
            â”œâ”€â”€ staging/
            â””â”€â”€ prod/
ArgoCD observa este repositorio para desplegar automÃ¡ticamente en el clÃºster K3s.

ğŸ” CI/CD + GitOps Flujo DevOps
plaintext
Copiar
Editar
1. Dev hace Git Push al frontend/backend
2. Jenkins se activa (webhook o polling)
3. Jenkins:
    - Clona el cÃ³digo fuente
    - Construye la imagen Docker
    - Sube la imagen a Docker Hub
    - Clona el repo GitOps
    - Modifica el `deployment.yaml` con el nuevo tag de imagen
    - Commit + push al GitOps repo

4. ArgoCD:
    - Detecta cambio en GitOps repo
    - Aplica los manifests automÃ¡ticamente en K3s
5. Traefik expone el servicio al pÃºblico (con o sin HTTPS)
ğŸ“Š Observabilidad
Grafana: Dashboard unificado

Prometheus (opcional): Scraping de mÃ©tricas

Loki: Logs de contenedores en tiempo real

Alloy: Reemplazo moderno para promtail/node exporter

cAdvisor: MÃ©tricas por pod

ğŸ—‚ Base de Datos + Almacenamiento
PostgreSQL desplegado en una mÃ¡quina virtual dedicada (externa al clÃºster)

PVC para base de datos montado sobre NFS

ComunicaciÃ³n entre los microservicios y la DB a travÃ©s de red privada

ğŸ”’ Seguridad y Networking
Traefik como IngressController (HTTP y HTTPS)

IP pÃºblica o DDNS configurada en router

HAProxy + Keepalived para alta disponibilidad de VIP

Acceso remoto cifrado por VPN (WireGuard)



k3d cluster create socialdevs-local \
  --agents 2 \
  --api-port 6550 \
  -p "80:80@loadbalancer" \
  -p "443:443@loadbalancer"


| OpciÃ³n                      | Significado                            |
| --------------------------- | -------------------------------------- |
| `socialdevs-local`          | Nombre del clÃºster                     |
| `--agents 2`                | 2 nodos worker                         |
| `--api-port 6550`           | Expone el API server en el puerto 6550 |
| `-p "80:80@loadbalancer"`   | Expone HTTP localmente                 |
| `-p "443:443@loadbalancer"` | Expone HTTPS localmente                |


ğŸ”§ Configura kubectl para usar el clÃºster
DespuÃ©s de crear el clÃºster, verifica que funciona:

bash
Copiar
Editar
kubectl get nodes
DeberÃ­as ver algo como:

bash
Copiar
Editar
NAME                    STATUS   ROLES                  AGE   VERSION
k3d-socialdevs-local-server-0   Ready    control-plane,master   1m    v1.29.x
k3d-socialdevs-local-agent-0    Ready    <none>                 1m    v1.29.x
k3d-socialdevs-local-agent-1    Ready    <none>                 1m    v1.29.x



| Nombre del Microservicio   | DescripciÃ³n                                                               | TecnologÃ­a     | Expone API | Conexiones                   |
| -------------------------- | ------------------------------------------------------------------------- | -------------- | ---------- | ---------------------------- |
| **frontend**               | AplicaciÃ³n web tipo Twitter (SPA)                                         | Vue.js + Nginx | No         | Consume `users` y `posts`    |
| **users-service**          | GestiÃ³n de usuarios (registro, login, lista)                              | FastAPI        | SÃ­         | PostgreSQL, frontend         |
| **posts-service**          | GestiÃ³n de publicaciones tipo tweet (crear, listar, eliminar)             | FastAPI        | SÃ­         | PostgreSQL, frontend         |
| **postgresql** *(externo)* | Base de datos relacional compartida para usuarios y posts                 | PostgreSQL     | No         | users-service, posts-service |
| **redpanda (opcional)**    | Event streaming para actividad de usuarios o futuros mÃ³dulos de analÃ­tica | Redpanda       | SÃ­         | posts-service, futuro ML     |
| **loki**                   | Sistema de logs centralizado                                              | Loki           | SÃ­         | Todos los microservicios     |
| **grafana**                | Dashboard para mÃ©tricas y logs (observabilidad)                           | Grafana        | SÃ­         | Loki, Alloy, Prometheus      |
| **cadvisor**               | Recolector de mÃ©tricas de contenedores                                    | cAdvisor       | SÃ­         | Prometheus/Grafana           |
| **alloy**                  | Recolector unificado de logs y mÃ©tricas (reemplazo moderno de promtail)   | Alloy          | SÃ­         | Grafana Cloud / Loki         |




k3d cluster delete socialdevs-local
k3d cluster create socialdevs-local \
  --agents 2 \
  --api-port 6550 \
  -p "80:80@loadbalancer" \
  -p "443:443@loadbalancer"




kubectl get ns
 k3d cluster list

 __
 ğŸ” Flujo CI/CD + GitOps Paso a Paso
ğŸ§± 1. Repositorios GitHub necesarios (mÃ­nimo 3)
Repositorio	Contenido
socialdevs-public-frontend	CÃ³digo fuente del frontend (Vue.js + Docker)
socialdevs-public-backend	CÃ³digo fuente del backend (FastAPI + Docker)
socialdevs-gitops	Manifiestos Kubernetes para ArgoCD

Opcional: Puedes tener un 4Âº repositorio: socialdevs-infra-ansible para la infraestructura (Traefik, Jenkins, etc.)

ğŸ³ 2. Repositorios en Docker Hub
Docker Hub Repo	Imagen
tu_usuario/frontend	Vue.js compilado con Nginx
tu_usuario/users-service	API de usuarios (FastAPI)
tu_usuario/posts-service	API de publicaciones (FastAPI)

ğŸ”§ 3. Jenkins â€“ Fase de IntegraciÃ³n Continua (CI)
Cada repositorio *-backend y *-frontend debe tener su propio Jenkinsfile con pasos como:

groovy
Copiar
Editar
pipeline {
  agent any
  stages {
    stage('Clonar') {
      steps {
        git 'https://github.com/tu_usuario/socialdevs-public-frontend.git'
      }
    }
    stage('Build Docker') {
      steps {
        sh 'docker build -t tu_usuario/frontend:latest .'
      }
    }
    stage('Push Docker') {
      steps {
        withCredentials([usernamePassword(credentialsId: 'dockerhub-creds', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
          sh "echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin"
          sh 'docker push tu_usuario/frontend:latest'
        }
      }
    }
    stage('Actualizar GitOps') {
      steps {
        git credentialsId: 'git-creds', url: 'https://github.com/tu_usuario/socialdevs-gitops.git'
        sh '''
          cd apps/socialdevs-frontend/overlays/dev
          sed -i "s|image: .*$|image: tu_usuario/frontend:latest|" deployment.yaml
          git config user.email "ci@jenkins.com"
          git config user.name "Jenkins"
          git commit -am "CI: update frontend image"
          git push
        '''
      }
    }
  }
}
ğŸš€ 4. ArgoCD â€“ Fase de Entrega Continua (CD)
ArgoCD monitorea el repositorio socialdevs-gitops

Detecta cambios automÃ¡ticamente en deployment.yaml

Despliega la nueva versiÃ³n en Kubernetes (k3d o k3s)

ğŸ’¡ Auto-sync habilitado: cuando ArgoCD ve que el manifiesto cambiÃ³, aplica el nuevo image: automÃ¡ticamente sin intervenciÃ³n.

ğŸŒ 5. Kubernetes (K3d o K3s)
Entorno	ClÃºster	ObservaciÃ³n
Desarrollo local	k3d-socialdevs-local	Ligero, sin cambios de infra
ProducciÃ³n real	k3s en VPS o bare-metal	Escalable, alta disponibilidad

ğŸ“ˆ 6. Observabilidad
Herramienta	FunciÃ³n
Grafana	Dashboards y mÃ©tricas
Loki	Logs centralizados
Alloy	Recolector moderno de logs
cAdvisor	MÃ©tricas de contenedores (CPU, RAM)

ğŸ§  Mapa mental paso a paso
ğŸ”„ Dev hace push a GitHub

âš™ï¸ Jenkins:

Clona repo fuente

Construye y sube imagen Docker

Actualiza manifiestos GitOps (nuevo image:)

Push a socialdevs-gitops

ğŸ¤– ArgoCD:

Detecta nuevo commit

Aplica el despliegue a K3s/K3d

âœ… Microservicio actualizado en producciÃ³n

ğŸ“Š Observabilidad en Grafana/Loki/cAdvisor



